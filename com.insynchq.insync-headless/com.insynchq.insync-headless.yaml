app-id: com.insynchq.insync-headless
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: insync-headless
finish-args:
  - --filesystem=home
  - --share=ipc
  # workaround for the unix file socket
  - --filesystem=/tmp
  - --share=network
  # workaround for the hardcoded ~/.config
  - --persist=.config/Insync
  - --persist=.config/Insync-headless
modules:
  - name: insync
    buildsystem: simple
    build-commands:
      -  install -Dm755 apply_extra /app/bin/apply_extra
      -  install -Dm755 insync-headless /app/bin/insync-headless
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - bsdtar -Oxf insync.deb data.tar.gz |
              tar -xz ./usr/lib/insync --strip-components=4
          - mkdir man
          - bsdtar -Oxf insync.deb data.tar.gz |
              tar -xz -C man ./usr/share/man/man1 --strip-components=5
          - rm -f insync.deb
      - type: dir
        path: resources
      - type: extra-data
        filename: insync.deb
        url: http://s.insynchq.com/builds/insync-headless_3.0.7.10610-buster_amd64.deb
        sha256: 893c13a545dd88a9dd4b1efb972fcb8ab71f9121e6831c3d7d7eeeb397936588
        size: 24959988
